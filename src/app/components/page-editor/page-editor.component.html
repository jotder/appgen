<div class="page-editor-form" [formGroup]="pageForm">
  <h3>{{ page.title }} ({{ page.id }}.json)</h3>
  <div class="form-field">
    <label for="title-{{page.id}}">Page Title:</label>
    <input id="title-{{page.id}}" formControlName="title" />
  </div>

  <h4>Widgets</h4>
  <div class="widget-management">
    <div class="form-field">
      <label for="widget-selector-{{page.id}}">Select a widget to edit:</label>
      <select id="widget-selector-{{page.id}}" [value]="selectedWidgetId()" (change)="onWidgetSelect($event)">
        <option value="null">-- Select a Widget --</option>
        @for (widget of page.widgets; track widget.instanceId) {
          <option [value]="widget.instanceId">{{ widget.config.title || widget.type }}</option>
        }
      </select>
    </div>

    <div class="widget-actions">
      <button (click)="addWidget()">Add New Widget</button>
      @if (editingWidget()) {
        <button class="danger" (click)="removeSelectedWidget()">Remove Selected Widget</button>
      }
    </div>
  </div>

  <div class="form-actions">
    <button (click)="save()">Save Page Changes</button>
  </div>
</div>

@if (showWidgetEditor()) {
  <app-widget-editor
    [widget]="editingWidget()"
    (widgetSaved)="handleWidgetSaved($event)"
    (cancelled)="handleWidgetEditorCancelled()"
  ></app-widget-editor>
}
